<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="552px" preserveAspectRatio="none" style="width:770px;height:552px;" version="1.1" viewBox="0 0 770 552" width="770px" zoomAndPan="magnify"><defs><filter height="300%" id="fp698vk0gp7ke" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="75" x2="75" y1="86.2969" y2="465.0234"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="216.5" x2="216.5" y1="86.2969" y2="465.0234"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="368.5" x2="368.5" y1="86.2969" y2="465.0234"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="540.5" x2="540.5" y1="86.2969" y2="465.0234"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="732.5" x2="732.5" y1="86.2969" y2="465.0234"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="39" x="53" y="82.9951">Client</text><ellipse cx="75.5" cy="13" fill="#FEFECE" filter="url(#fp698vk0gp7ke)" rx="8" ry="8" style="stroke: #A80036; stroke-width: 2.0;"/><path d="M75.5,21 L75.5,48 M62.5,29 L88.5,29 M75.5,48 L62.5,63 M75.5,48 L88.5,63 " fill="none" filter="url(#fp698vk0gp7ke)" style="stroke: #A80036; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="39" x="53" y="477.0186">Client</text><ellipse cx="75.5" cy="490.3203" fill="#FEFECE" filter="url(#fp698vk0gp7ke)" rx="8" ry="8" style="stroke: #A80036; stroke-width: 2.0;"/><path d="M75.5,498.3203 L75.5,525.3203 M62.5,506.3203 L88.5,506.3203 M75.5,525.3203 L62.5,540.3203 M75.5,525.3203 L88.5,540.3203 " fill="none" filter="url(#fp698vk0gp7ke)" style="stroke: #A80036; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="98" x="164.5" y="82.9951">Proxy1(IP: IP1)</text><ellipse cx="216.5" cy="54" fill="#FEFECE" filter="url(#fp698vk0gp7ke)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><line style="stroke: #A80036; stroke-width: 2.0;" x1="204.5" x2="228.5" y1="68" y2="68"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="98" x="164.5" y="477.0186">Proxy1(IP: IP1)</text><ellipse cx="216.5" cy="496.3203" fill="#FEFECE" filter="url(#fp698vk0gp7ke)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><line style="stroke: #A80036; stroke-width: 2.0;" x1="204.5" x2="228.5" y1="510.3203" y2="510.3203"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="98" x="316.5" y="82.9951">Proxy2(IP: IP2)</text><ellipse cx="368.5" cy="54" fill="#FEFECE" filter="url(#fp698vk0gp7ke)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><line style="stroke: #A80036; stroke-width: 2.0;" x1="356.5" x2="380.5" y1="68" y2="68"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="98" x="316.5" y="477.0186">Proxy2(IP: IP2)</text><ellipse cx="368.5" cy="496.3203" fill="#FEFECE" filter="url(#fp698vk0gp7ke)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><line style="stroke: #A80036; stroke-width: 2.0;" x1="356.5" x2="380.5" y1="510.3203" y2="510.3203"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="98" x="488.5" y="82.9951">Proxy3(IP: IP3)</text><ellipse cx="540.5" cy="54" fill="#FEFECE" filter="url(#fp698vk0gp7ke)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><line style="stroke: #A80036; stroke-width: 2.0;" x1="528.5" x2="552.5" y1="68" y2="68"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="98" x="488.5" y="477.0186">Proxy3(IP: IP3)</text><ellipse cx="540.5" cy="496.3203" fill="#FEFECE" filter="url(#fp698vk0gp7ke)" rx="12" ry="12" style="stroke: #A80036; stroke-width: 2.0;"/><line style="stroke: #A80036; stroke-width: 2.0;" x1="528.5" x2="552.5" y1="510.3203" y2="510.3203"/><rect fill="#FEFECE" filter="url(#fp698vk0gp7ke)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="58" x="701.5" y="51"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="44" x="708.5" y="70.9951">Server</text><rect fill="#FEFECE" filter="url(#fp698vk0gp7ke)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="58" x="701.5" y="464.0234"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="44" x="708.5" y="484.0186">Server</text><path d="M8,101.2969 L8,126.2969 L67,126.2969 L67,111.2969 L57,101.2969 L8,101.2969 " fill="#FBFB77" filter="url(#fp698vk0gp7ke)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M57,101.2969 L57,111.2969 L67,111.2969 L57,101.2969 " fill="#FBFB77" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="38" x="14" y="118.3638">IP: IP0</text><path d="M148,140.4297 L148,165.4297 L207,165.4297 L207,150.4297 L197,140.4297 L148,140.4297 " fill="#FBFB77" filter="url(#fp698vk0gp7ke)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M197,140.4297 L197,150.4297 L207,150.4297 L197,140.4297 " fill="#FBFB77" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="38" x="154" y="157.4966">IP: IP1</text><path d="M300,179.5625 L300,204.5625 L359,204.5625 L359,189.5625 L349,179.5625 L300,179.5625 " fill="#FBFB77" filter="url(#fp698vk0gp7ke)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M349,179.5625 L349,189.5625 L359,189.5625 L349,179.5625 " fill="#FBFB77" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="38" x="306" y="196.6294">IP: IP2</text><path d="M472,218.6953 L472,243.6953 L531,243.6953 L531,228.6953 L521,218.6953 L472,218.6953 " fill="#FBFB77" filter="url(#fp698vk0gp7ke)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M521,218.6953 L521,228.6953 L531,228.6953 L521,218.6953 " fill="#FBFB77" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="38" x="478" y="235.7622">IP: IP3</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="214.5" x2="204.5" y1="289.0938" y2="285.0938"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="214.5" x2="204.5" y1="289.0938" y2="293.0938"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="75.5" x2="215.5" y1="289.0938" y2="289.0938"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="117" x="82.5" y="268.895">无X-Forwarded-For</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="110" x="82.5" y="284.0278">remote_addr: IP0</text><path d="M221,260.3945 L221,285.3945 L466,285.3945 L466,270.3945 L456,260.3945 L221,260.3945 " fill="#FBFB77" filter="url(#fp698vk0gp7ke)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M456,260.3945 L456,270.3945 L466,270.3945 L456,260.3945 " fill="#FBFB77" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="224" x="227" y="277.4614">remote_addr是TCP层参数，不能伪造</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="366.5" x2="356.5" y1="333.3594" y2="329.3594"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="366.5" x2="356.5" y1="333.3594" y2="337.3594"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="216.5" x2="367.5" y1="333.3594" y2="333.3594"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="128" x="223.5" y="313.1606">X-Forwarded-For: P0</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="110" x="223.5" y="328.2935">remote_addr: IP1</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="538.5" x2="528.5" y1="390.1914" y2="386.1914"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="538.5" x2="528.5" y1="390.1914" y2="394.1914"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="368.5" x2="539.5" y1="390.1914" y2="390.1914"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="148" x="375.5" y="369.9927">X-Forwarded-For: P0,P1</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="110" x="375.5" y="385.1255">remote_addr: IP2</text><path d="M545,346.3594 L545,401.3594 L757,401.3594 L757,356.3594 L747,346.3594 L545,346.3594 " fill="#FBFB77" filter="url(#fp698vk0gp7ke)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M747,346.3594 L747,356.3594 L757,356.3594 L747,346.3594 " fill="#FBFB77" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="169" x="551" y="363.4263">X-Forwarded-For转发一次，</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="191" x="551" y="378.5591">新增一个IP，添加的是请求者的IP</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="136" x="551" y="393.6919">(P3为P2转发，添加P2)</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="730.5" x2="720.5" y1="447.0234" y2="443.0234"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="730.5" x2="720.5" y1="447.0234" y2="451.0234"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="540.5" x2="731.5" y1="447.0234" y2="447.0234"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="168" x="547.5" y="426.8247">X-Forwarded-For: P0,P1,P2</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="110" x="547.5" y="441.9575">remote_addr: IP3</text><!--MD5=[5b7a25784aefbb663914075eb620fb5e]
@startuml X-Forwarded-For
  actor "Client" as C
  note left of C: IP: IP0
  entity "Proxy1(IP: IP1)" as P1
  note left of P1: IP: IP1
  entity "Proxy2(IP: IP2)" as P2
  note left of P2: IP: IP2
  entity "Proxy3(IP: IP3)" as P3
  note left of P3: IP: IP3
  participant "Server" as S

  C ->> P1: 无X-Forwarded-For\nremote_addr: IP0
  note right: remote_addr是TCP层参数，不能伪造
  P1 ->> P2: X-Forwarded-For: P0\nremote_addr: IP1
  P2 ->> P3: X-Forwarded-For: P0,P1\nremote_addr: IP2
  note right
    X-Forwarded-For转发一次，
    新增一个IP，添加的是请求者的IP
    (P3为P2转发，添加P2)
  end note
  P3 ->> S: X-Forwarded-For: P0,P1,P2\nremote_addr: IP3
@enduml

PlantUML version 1.2020.12(Sat Jun 06 10:54:15 UTC 2020)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Default Encoding: UTF-8
Language: en
Country: null
--></g></svg>